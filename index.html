<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meridian International School - Class 9 Computer Exam</title>
<style>
:root{
  --green:#4CAF50;
  --blue:#3498db;
  --muted:#f1f1f1;
  --danger:#e74c3c;
  --card-bg:#fff;
  --shadow: 0 0 10px rgba(12, 16, 11, 0.12);
  --radius:30px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--muted);color:#01030b}
.header{position:fixed;top:0;left:0;right:0;height:100px;background:var(--card-bg);border-bottom:1px solid #060508;display:flex;align-items:center;justify-content:space-between;padding:12px 18px;z-index:250;border-radius:20px}
.school-title h1{margin:0;font-size:70px}
.school-title h2{margin:0;font-size:20px;color:#080707}
#studentDisplay{font-weight:900}
#timer{font-weight:900;color:var(--danger);font-size:20px}
.container{margin-top:92px;padding:18px;max-width:1100px;margin-left:auto;margin-right:auto}
.center-box{max-width:500px;margin:100px auto;background:var(--card-bg);padding:26px;border-radius:var(--radius);box-shadow:var(--shadow)}
.center-box h2{text-align:center;margin:0 0 16px}
.center-box input{width:100%;padding:10px 12px;margin:10px 0;border-radius:6px;border:1px solid #ccc;font-size:15px}
.center-box button{width:100%;padding:12px;background:var(--green);border:none;color:#fff;border-radius:8px;font-size:16px;cursor:pointer}
.error{color:#c0392b;text-align:center;margin-top:8px}
.instructions{background:var(--card-bg);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);max-width:900px;margin:20px auto}
.instructions h3{margin-top:0}
.instructions ol{padding-left:18px}
.start-row{display:flex;gap:12px;align-items:center;margin-top:12px}
.start-row input[type="checkbox"]{transform:scale(1.2);margin-right:6px}
.start-row button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.start-btn{background:var(--green);color:#fff}
.start-btn:disabled{opacity:.55;cursor:not-allowed}
.exam-layout{display:flex;gap:18px;align-items:flex-start}
#examPage{position:relative}
#examPage::before{content:"";background:url('logo.png') no-repeat center;background-size:250px;opacity:0.30;position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.question-area{flex:3;background:var(--card-bg);border-radius:var(--radius);padding:30px;box-shadow:var(--shadow);min-height:500px}
.question {font-size:20px;margin-bottom:18px}
.options label{display:block;padding:10px 8px;cursor:pointer}
.nav-buttons{display:flex;justify-content:space-between;margin-top:12px}
.nav-buttons button{padding:10px 16px;border-radius:8px;border:none;cursor:pointer}
.nav-left{background:#ddd}
.nav-right{background:var(--green);color:#fff}
.sidebar{width:300px;min-height:500px}
.legend{background:var(--card-bg);padding:30px;border-radius:30px;margin-bottom:20px;border:3px solid #ebe9e9;text-align:center;font-size:15px}
.legend span{display:inline-block;margin:0 8px;padding:6px 8px;border-radius:10px;font-weight:700}
.leg-white{background:#fff;border:2px solid #bbb}
.leg-blue{background:var(--blue);color:#fff}
.leg-green{background:var(--green);color:#fff}
#questionNumbers{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:10px;background:var(--card-bg);border-radius:8px;box-shadow:var(--shadow)}
.question-number{width:42px;height:42px;border-radius:6px;border:1px solid #aaa;display:flex;align-items:center;justify-content:center;cursor:pointer;background:#fff;font-weight:700;user-select:none}
.question-number.seen{background:var(--blue);color:#fff;border-color:var(--blue)}
.question-number.answered{background:var(--green);color:#fff;border-color:var(--green)}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:300}
.modal{width:90%;max-width:700px;background:#fff;padding:18px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.25)}
.modal h3{margin-top:0}
.preview-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:12px 0}
.preview-item{padding:8px;border-radius:6px;text-align:center;cursor:pointer;border:1px solid #bbb;background:#fff}
.preview-item.answered{background:var(--green);color:#fff;border-color:var(--green)}
.preview-item.seen{background:var(--blue);color:#fff;border-color:var(--blue)}
.preview-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.btn-secondary{background:#ddd}
.btn-danger{background:var(--danger);color:#fff}
.btn-green{background:var(--green);color:#fff;margin-top:12px;display:block;width:100%;}
#result{margin-top:12px;padding:10px;border-radius:8px;background:#fafafa;border:1px solid #eee;text-align:center;font-weight:700}
@media (max-width:900px){
  .exam-layout{flex-direction:column}
  .sidebar{width:100%}
  .preview-grid{grid-template-columns:repeat(5,1fr)}
}
</style>
</head>
<body>

<div class="header">
  <div class="school-title">
    <h1>Meridian International School</h1>
    <h2>SUBJECT : ICT  |CBT | DATE: 19 Oct 2025 </h2>
  </div>
  <div style="display:flex;gap:18px;align-items:center">
    <div id="studentDisplay">Not logged in</div>
    <div>Time Left: <span id="timer">15:00</span></div>
  </div>
</div>

<div class="container">
  <!-- LOGIN PAGE -->
  <div id="loginPage" class="center-box" aria-live="polite">
    <img src="logo.png" alt="School Logo" style="width:120px; display:block; margin:0 auto 15px;">
    <h2>Login to Start Exam</h2>
    <input id="username" placeholder="Enter Username" autocomplete="username" />
    <input id="password" placeholder="Enter Password" type="password" autocomplete="current-password" />
    <div class="error" id="loginError"></div>
    <button id="loginBtn">Login</button>
  </div>

  <!-- INSTRUCTIONS -->
  <div id="instructionPage" class="instructions" style="display:none;">
    <h3>Exam Instructions :</h3>
    <ol>
      <li>You have <strong>15 minutes</strong> to complete the exam.</li><br>
      <li>A <strong>warning alert</strong> will appear when <strong>5 minutes</strong> remain.</li><br>
      <li>The exam will be <strong>automatically submitted</strong> when the timer reaches <strong>00:00</strong>.</li><br>
      <li>Use <strong>Previous</strong> and <strong>Next</strong> to navigate or click question numbers in the sidebar.</li><br>
      <li><strong>Color Code</strong><br>:
        <ul>
          <li><strong>White</strong> — Not visited</li><br>
          <li><span style="color:#fff;background:var(--blue);padding:2px 6px;border-radius:4px">Blue</span> — Seen but not answered</li><br>
          <li><span style="color:#fff;background:var(--green);padding:2px 6px;border-radius:4px">GREEN</span> — Answered</li><br>
        </ul>
      </li>
      <li>Click <strong>Preview</strong> to see a summary of all questions before final submission.</li><br>
      <li>Once finalized and submitted, you <strong>cannot change</strong> your answers.</li><br>
      <li>Do not refresh/close the window during the exam.</li><br>
    </ol>

    <div class="start-row">
      <label style="display:flex;align-items:center;gap:8px">
        <input type="checkbox" id="agreeCheckbox" />
        I have read and understood the instructions.
      </label>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button id="backToLogin" class="btn btn-secondary">.</button>
        <button id="startExamBtn" class="start-btn" disabled>Start Exam</button>
      </div>
    </div>
  </div>

  <!-- EXAM PAGE -->
  <div id="examPage" style="display:none;">
    <div style="display:flex;gap:18px;align-items:flex-start">
      <div class="question-area">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="display:flex;gap:8px;align-items:center">
            <strong>Question</strong>
            <div style="color:#666;font-size:13px;margin-left:10px" id="qProgress"></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="previewBtn" class="btn btn-secondary">Preview</button>
            <button id="submitExamBtn" class="btn btn-danger">Submit Exam</button>
          </div>
        </div>
        <div id="questionContainer"></div>
        <div class="nav-buttons">
          <button id="prevBtn" class="nav-left">Previous</button>
          <button id="nextBtn" class="nav-right">Next</button>
        </div>
        <div id="result" style="display:none"></div>
      </div>

      <div class="sidebar">
        <div class="legend">
          <span class="leg-white">⚪ Not visited</span>
          <span class="leg-blue">🔵 Seen</span>
          <span class="leg-green">🟩 Answered</span>
        </div>
        <div id="questionNumbers" aria-label="Question numbers"></div>
      </div>
    </div>
  </div>
</div>

<!-- PREVIEW MODAL -->
<div class="modal-backdrop" id="previewModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
    <h3 id="previewTitle">Preview — Question Status</h3>
    <div class="preview-grid" id="previewGrid"></div>
    <div class="preview-actions">
      <button class="btn btn-secondary" id="closePreview">Close</button>
      <button class="btn" id="reviewAllBtn">Review Unanswered</button>
      <button class="btn btn-danger" id="finalSubmitBtn">Finalize & Submit</button>
    </div>
  </div>
</div>

<script>
// === SHUFFLE HELPERS ===
function shuffleArray(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function shuffleOptions(question){
  let options = question.options.map((opt,index)=>({text:opt,index}));
  options = shuffleArray(options);
  question.options = options.map(o=>o.text);
  question.answer = options.findIndex(o=>o.index === question.answer);
}

// === STUDENTS ===
const students={"satyam":{password:"1234",name:"Satyam Singh",roll:1},"rahul":{password:"2345",name:"Rahul Sharma",roll:2},"neha":{password:"3456",name:"Neha Singh",roll:3},"anmol":{password:"4567",name:"Anmol Verma",roll:4},"tanya":{password:"5678",name:"Tanya Gupta",roll:5},"vikas":{password:"6789",name:"Vikas Kumar",roll:6}};

// === QUESTIONS ===
let questions = [
  {q:"Which of these is an input device?",options:["Keyboard","Monitor","Printer"],answer:0},
  {q:"Which memory is volatile?",options:["RAM","ROM","Hard Disk"],answer:0},
  {q:"Full form of ICT?",options:["Information and Communication Technology","Internet and Computer Technology","International Computer Tech"],answer:0},
  {q:"Which of these is a storage device?",options:["Hard Disk","Mouse","Keyboard"],answer:0},
  {q:"Which is the brain of the computer?",options:["CPU","RAM","Monitor"],answer:0},
  {q:"Which of the following is an operating system?",options:["Windows","Microsoft Word","Excel"],answer:0},
  {q:"Which of these is software?",options:["Microsoft Excel","Keyboard","Printer"],answer:0},
  {q:"Which of these is a network device?",options:["Router","Monitor","CPU"],answer:0},
  {q:"The output of a compiler is?",options:["Object Code","Source Code","Assembly Code"],answer:0},
  {q:"Which of these is secondary memory?",options:["CD","RAM","ROM"],answer:0},
  {q:"A website address is called?",options:["URL","IP Address","Domain"],answer:0},
  {q:"First computer programmer was?",options:["Ada Lovelace","Charles Babbage","Alan Turing"],answer:0},
  {q:"Which is used for calculations?",options:["Spreadsheet","Word Processor","Database"],answer:0},
  {q:"WWW stands for?",options:["World Wide Web","Wide Web World","Web World Wide"],answer:0},
  {q:"Which programming language is used for web pages?",options:["HTML","Python","C++"],answer:0}
];

// === STATE ===
let currentQuestion=0,userAnswers={},seenQuestions=new Set(),timerInterval=null;
const totalQuestions=questions.length;
let remainingSec=15*60;

// === DOM ===
const loginPage=document.getElementById('loginPage');
const instructionPage=document.getElementById('instructionPage');
const examPage=document.getElementById('examPage');
const studentDisplay=document.getElementById('studentDisplay');
const loginBtn=document.getElementById('loginBtn');
const startExamBtn=document.getElementById('startExamBtn');
const agreeCheckbox=document.getElementById('agreeCheckbox');
const backToLogin=document.getElementById('backToLogin');
const loginError=document.getElementById('loginError');
const usernameInput=document.getElementById('username');
const passwordInput=document.getElementById('password');
const questionContainer=document.getElementById('questionContainer');
const questionNumbers=document.getElementById('questionNumbers');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const timerDisplay=document.getElementById('timer');
const previewBtn=document.getElementById('previewBtn');
const previewModal=document.getElementById('previewModal');
const previewGrid=document.getElementById('previewGrid');
const closePreview=document.getElementById('closePreview');
const reviewAllBtn=document.getElementById('reviewAllBtn');
const finalSubmitBtn=document.getElementById('finalSubmitBtn');
const submitExamBtn=document.getElementById('submitExamBtn');
const qProgress=document.getElementById('qProgress');

// === LOGIN FLOW ===
loginBtn.addEventListener('click',()=>{
  loginError.innerText="";
  const username=usernameInput.value.trim();
  const password=passwordInput.value.trim();
  if(!username||!password){loginError.innerText="Please fill both fields!";return;}
  if(students[username]&&students[username].password===password){
    loginPage.style.display='none';
    instructionPage.style.display='block';
    const s=students[username];
    studentDisplay.innerText=`Name: ${s.name} | Roll No: ${s.roll}`;
    createSidebar();
    showQuestion(0,true);
  } else loginError.innerText="Invalid username or password!";
});

backToLogin.addEventListener('click',()=>{
  instructionPage.style.display='none';
  loginPage.style.display='block';
});

agreeCheckbox.addEventListener('change',()=>{startExamBtn.disabled=!agreeCheckbox.checked});

// === START EXAM ===
startExamBtn.addEventListener('click',()=>{
  instructionPage.style.display='none';
  examPage.style.display='block';
  questions=shuffleArray(questions);
  questions.forEach(q=>shuffleOptions(q));
  showQuestion(0,true);
  startTimer(remainingSec);
});

// === SIDEBAR & NAVIGATION ===
function createSidebar(){
  questionNumbers.innerHTML="";
  questions.forEach((q,i)=>{
    const qBtn=document.createElement('div');
    qBtn.className='question-number';
    qBtn.innerText=i+1;
    qBtn.addEventListener('click',()=>showQuestion(i));
    questionNumbers.appendChild(qBtn);
  });
}

function updateSidebar(){
  questions.forEach((q,i)=>{
    const qBtn=questionNumbers.children[i];
    qBtn.classList.remove('seen','answered');
    if(seenQuestions.has(i)) qBtn.classList.add('seen');
    if(userAnswers[i]!=null) qBtn.classList.add('answered');
  });
}

// === SHOW QUESTION ===
function showQuestion(index,skipSeen=false){
  currentQuestion=index;
  const q=questions[index];
  seenQuestions.add(index);
  let html=`<div class="question">${index+1}. ${q.q}</div>`;
  html+=`<div class="options">`;
  q.options.forEach((opt,i)=>{
    const checked=userAnswers[index]===i?'checked':'';
    html+=`<label><input type="radio" name="q${index}" value="${i}" ${checked} onchange="selectAnswer(${index},${i})"/> ${opt}</label>`;
  });
  html+=`</div>`;
  questionContainer.innerHTML=html;
  updateSidebar();
  updateQProgress();
}

// === SELECT ANSWER ===
function selectAnswer(qIndex,optIndex){
  userAnswers[qIndex]=optIndex;
  updateSidebar();
}

// === NAV BUTTONS ===
prevBtn.addEventListener('click',()=>{if(currentQuestion>0)showQuestion(currentQuestion-1)});
nextBtn.addEventListener('click',()=>{if(currentQuestion<questions.length-1)showQuestion(currentQuestion+1)});

// === TIMER ===
function startTimer(duration){
  remainingSec=duration;
  timerInterval=setInterval(()=>{
    let min=Math.floor(remainingSec/60);
    let sec=remainingSec%60;
    timerDisplay.innerText=`${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    if(remainingSec===300)alert("5 minutes remaining!");
    if(remainingSec<=0){
      clearInterval(timerInterval);
      submitExam();
    }
    remainingSec--;
  },1000);
}

// === PREVIEW MODAL ===
// === PREVIEW MODAL ===
function updatePreviewModal() {
  previewGrid.innerHTML = '';

  questions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'preview-item';

    // Apply color coding
    if (userAnswers[i] != null) {
      div.classList.add('answered'); // Green
    } else if (seenQuestions.has(i)) {
      div.classList.add('seen'); // Blue
    } else {
      div.style.background = '#f44336'; // Red for not visited
      div.style.color = '#fff';
      div.style.borderColor = '#e53935';
    }

    div.innerText = i + 1;

    // Clicking jumps to question and closes modal
    div.addEventListener('click', () => {
      showQuestion(i);
      previewModal.style.display = 'none';
    });

    previewGrid.appendChild(div);
  });

  // Show the modal
  previewModal.style.display = 'flex';
}

// === PREVIEW BUTTON ===
previewBtn.addEventListener('click', updatePreviewModal);

// === MODAL ACTION BUTTONS ===
// === PREVIEW MODAL BUTTONS ===
closePreview.addEventListener('click', () => {
  previewModal.style.display = 'none';
});

reviewAllBtn.addEventListener('click', () => {
  // Jump to first unanswered/not visited question
  for (let i = 0; i < questions.length; i++) {
    if (userAnswers[i] == null) {
      showQuestion(i);
      break;
    }
  }
  previewModal.style.display = 'none';
});

finalSubmitBtn.addEventListener('click', () => {
  previewModal.style.display = 'none';
  examPage.style.display = 'none';  // hide exam page immediately
  submitExam();                     // call submitExam function
});




// === UPDATE QUESTION PROGRESS ===
function updateQProgress(){qProgress.innerText=`${currentQuestion+1} / ${totalQuestions}`;}

// === SUBMIT EXAM & RESULTS ===
function submitExam(){
  if(Object.keys(userAnswers).length < totalQuestions){
    if(!confirm("Some questions are unanswered. Do you want to submit anyway?")) return;
  }
  clearInterval(timerInterval);
  examPage.style.display='none';
  previewModal.style.display='none';
  let score=0,resultHTML="<h3>Exam Results:</h3><ol>";
  questions.forEach((q,i)=>{
    const userAns=userAnswers[i];
    const correctAns=q.answer;
    if(userAns===correctAns){score++;resultHTML+=`<li>${q.q} ✅</li>`}
    else{resultHTML+=`<li>${q.q} ❌ Correct: ${q.options[correctAns]}</li>`}
  });
  resultHTML+=`</ol><h3>Total Score: ${score} / ${questions.length}</h3>`;
  document.body.insertAdjacentHTML('beforeend',`<div class="center-box">${resultHTML}<button onclick="downloadCSV()" class="btn btn-green">Download CSV</button></div>`);
}
// === TOP-RIGHT SUBMIT BUTTON ===
submitExamBtn.addEventListener('click', () => {
  if(confirm("Are you sure you want to submit the exam?")){
    examPage.style.display = 'none';      // hide exam page
    previewModal.style.display = 'none';   // hide modal if open
    submitExam();                          // call submit function
  }
});

// === SUBMIT EXAM FUNCTION ===
function submitExam(){
  clearInterval(timerInterval);            // stop timer
  examPage.style.display = 'none';
  previewModal.style.display = 'none';

  let score = 0, resultHTML = "<h3>Exam Results:</h3><ol>";

  questions.forEach((q,i)=>{
    const userAns = userAnswers[i];
    const correctAns = q.answer;
    if(userAns === correctAns){
      score++;
      resultHTML += `<li>${q.q} ✅</li>`;
    } else {
      resultHTML += `<li>${q.q} ❌ Correct: ${q.options[correctAns]}</li>`;
    }
  });

  resultHTML += `</ol><h3>Total Score: ${score} / ${questions.length}</h3>`;

  // Display result
  document.body.insertAdjacentHTML('beforeend',`
    <div class="center-box">
      ${resultHTML}
      <button onclick="downloadCSV()" class="btn btn-green">Download CSV</button>
    </div>
  `);
}


// === DOWNLOAD CSV ===
function downloadCSV(){
  let csv="Question,Your Answer,Correct Answer\n";
  questions.forEach((q,i)=>{
    const userAns=userAnswers[i]!=null?q.options[userAnswers[i]]:'Not Answered';
    const correctAns=q.options[q.answer];
    csv+=`"${q.q}","${userAns}","${correctAns}"\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='exam_results.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>
</body>
</html>
